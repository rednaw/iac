{
  "name": "IaC Development",
  "build": {
    "context": "..",
    "dockerfile": "../Dockerfile"
  },

  "mounts": [
    "source=${localEnv:HOME}/.ssh,target=/home/vscode/.ssh,type=bind",
    "source=${localEnv:HOME}/.config/sops,target=/home/vscode/.config/sops,type=bind,readonly",
    "source=${localEnv:APP_HOST_PATH}/iac.yml,target=/workspaces/iac/app/iac.yml,type=bind,readonly",
    "source=${localEnv:APP_HOST_PATH}/docker-compose.yml,target=/workspaces/iac/app/docker-compose.yml,type=bind,readonly",
    "source=${localEnv:APP_HOST_PATH}/.env,target=/workspaces/iac/app/.env,type=bind,readonly",
    "source=${localEnv:APP_HOST_PATH}/.sops.yaml,target=/workspaces/iac/app/.sops.yaml,type=bind,readonly"
  ],

  "customizations": {
    "vscode": {
      "extensions": [
        "bierner.markdown-mermaid",
        "signageos.signageos-vscode-sops",
        "redhat.vscode-yaml",
        "redhat.ansible",
        "mikestead.dotenv"
      ],
      "settings": {
        "sops.defaults.ageKeyFile": "/home/vscode/.config/sops/age/keys.txt",
        "files.associations": {
          "*.env": "dotenv",
          ".env": "dotenv"
        },
        "yaml.schemas": {
          "Traefik v2": "ansible/roles/server/templates/traefik*.j2"
        },
        "yaml.customTags": [
          "!vault",
          "!include",
          "!include_role",
          "!include_tasks"
        ],
        "ansible.python.interpreterPath": "/usr/bin/python3"
      }
    },
    "remote.containers.autoReopen": true
  },

  "remoteUser": "vscode",
  
  "postCreateCommand": "bash .devcontainer/devcontainer-setup.sh",
  
  "postStartCommand": "bash .devcontainer/tunnel-start.sh",
  
  "features": {
    "ghcr.io/devcontainers/features/docker-outside-of-docker:1": {}
  }
}
