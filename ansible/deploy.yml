---
# Standalone playbook for deploying hello-world app
# Usage: task ...

- name: Deploy Hello World App
  hosts: all
  become: yes

  pre_tasks:
  - name: Decrypt and load infrastructure secrets
    ansible.builtin.import_tasks: tasks/secrets.yml

  tasks:
  - name: Ensure app directory exists
    ansible.builtin.file:
      path: /opt/giftfinder/hello
      state: directory
      owner: giftfinder
      group: giftfinder
      mode: '0755'

  - name: Copy docker-compose file
    ansible.builtin.copy:
      src: "{{ playbook_dir }}/../apps/hello/docker-compose.yml"
      dest: /opt/giftfinder/hello/docker-compose.yml
      owner: giftfinder
      group: giftfinder
      mode: '0644'

  - name: Deploy hello-world container
    community.docker.docker_compose_v2:
      project_src: /opt/giftfinder/hello
      state: present
      pull: missing
      recreate: auto
