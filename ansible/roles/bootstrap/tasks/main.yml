---
# Bootstrap role: prepare ubuntu user for subsequent Ansible runs
# This role runs as root and creates the ubuntu user with sudo access

- name: Ensure Ansible remote_tmp directory exists with correct permissions
  ansible.builtin.file:
    path: /root/.ansible/tmp
    state: directory
    mode: '1777'
    owner: root
    group: root

- name: Ensure ubuntu user exists with home and sudo
  ansible.builtin.user:
    name: ubuntu
    shell: /bin/bash
    create_home: yes
    groups: sudo
    append: yes

- name: Configure passwordless sudo with enhanced logging for ubuntu user
  ansible.builtin.template:
    src: sudoers-ubuntu.j2
    dest: /etc/sudoers.d/90-ubuntu-sudo
    mode: '0440'
    validate: 'visudo -cf %s'
    backup: yes
