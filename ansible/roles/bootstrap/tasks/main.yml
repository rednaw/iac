---
# Bootstrap role: prepare ubuntu user for subsequent Ansible runs
# This role runs as root and creates the ubuntu user with sudo access

- name: Create Ansible temp directory
  ansible.builtin.file:
    path: /root/.ansible/tmp
    state: directory
    mode: '1777'
    owner: root
    group: root

- name: Create ubuntu user
  ansible.builtin.user:
    name: ubuntu
    shell: /bin/bash
    create_home: true
    groups: sudo
    append: true

- name: Configure sudo access
  ansible.builtin.template:
    src: sudoers-ubuntu.j2
    dest: /etc/sudoers.d/90-ubuntu-sudo
    mode: '0440'
    validate: 'visudo -cf %s'
    backup: true
