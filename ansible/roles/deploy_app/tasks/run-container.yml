---
# Run the application container with Docker Compose
#
# Inputs:
#   deploy_target: Target path on server (contains docker-compose.yml)
#
# Outputs:
#   deploy_result: Docker Compose deployment result

- name: Remove existing containers
  community.docker.docker_compose_v2:
    project_src: "{{ deploy_target }}"
    state: absent
  become: true
  become_user: deploy
  failed_when: false  # OK to fail if no containers exist yet

- name: Start application containers
  community.docker.docker_compose_v2:
    project_src: "{{ deploy_target }}"
    state: present
    pull: missing
    recreate: always
    remove_orphans: true
  become: true
  become_user: deploy
  register: deploy_result
